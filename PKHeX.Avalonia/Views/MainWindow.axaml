<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PKHeX.Avalonia.ViewModels"
        xmlns:views="using:PKHeX.Avalonia.Views"
        x:Class="PKHeX.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="1100" Height="650"
        MinWidth="900" MinHeight="500">

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenFileCommand}" />
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveFileCommand}" />
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding SaveFileAsCommand}" />
    </Window.KeyBindings>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Open..." Command="{Binding OpenFileCommand}" InputGesture="Ctrl+O" />
                <MenuItem Header="_Save" Command="{Binding SaveFileCommand}" InputGesture="Ctrl+S" />
                <MenuItem Header="Save _As..." Command="{Binding SaveFileAsCommand}" InputGesture="Ctrl+Shift+S" />
                <Separator />
                <MenuItem Header="_Close" Command="{Binding CloseFileCommand}" />
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="Showdown">
                    <MenuItem Header="Import Set from Clipboard" Command="{Binding ImportShowdownCommand}" InputGesture="Ctrl+T" />
                    <MenuItem Header="Export Set to Clipboard" Command="{Binding ExportShowdownCommand}" InputGesture="Ctrl+Shift+T" />
                </MenuItem>
                <MenuItem Header="Data">
                    <MenuItem Header="Load Boxes" Command="{Binding LoadBoxesCommand}" />
                    <MenuItem Header="Dump Boxes" Command="{Binding DumpBoxesCommand}" />
                    <MenuItem Header="PKM Database" Command="{Binding OpenPKMDatabaseCommand}" />
                    <MenuItem Header="Mystery Gift Database" Command="{Binding OpenMysteryGiftDatabaseCommand}" />
                    <MenuItem Header="Block Editor" Command="{Binding OpenBlockEditorCommand}" />
                    <MenuItem Header="Encounter Database" Command="{Binding OpenEncounterDatabaseCommand}" />
                </MenuItem>
                <MenuItem Header="Batch Editor" Command="{Binding OpenBatchEditorCommand}" />
                <MenuItem Header="Box Manipulation" Command="{Binding OpenBoxManipCommand}" />
                <MenuItem Header="Save Editors">
                    <MenuItem Header="Daycare" Command="{Binding OpenDaycareCommand}" />
                    <MenuItem Header="Records" Command="{Binding OpenRecordsCommand}" />
                    <MenuItem Header="Hall of Fame" Command="{Binding OpenHallOfFameCommand}" />
                    <Separator />
                    <MenuItem Header="Gen 3">
                        <MenuItem Header="Roamer" Command="{Binding OpenRoamerCommand}" />
                        <MenuItem Header="Secret Base" Command="{Binding OpenSecretBaseCommand}" />
                        <MenuItem Header="RTC (Clock)" Command="{Binding OpenRTCCommand}" />
                    </MenuItem>
                    <MenuItem Header="Gen 4">
                        <MenuItem Header="Apricorns (HGSS)" Command="{Binding OpenApricornCommand}" />
                        <MenuItem Header="Honey Trees (DPPt)" Command="{Binding OpenHoneyTreeCommand}" />
                        <MenuItem Header="Underground (DPPt)" Command="{Binding OpenUndergroundCommand}" />
                        <MenuItem Header="Chatter" Command="{Binding OpenChatterCommand}" />
                    </MenuItem>
                    <MenuItem Header="Gen 5">
                        <MenuItem Header="Chatter" Command="{Binding OpenChatterCommand}" />
                    </MenuItem>
                    <MenuItem Header="Gen 6">
                        <MenuItem Header="O-Powers" Command="{Binding OpenOPowerCommand}" />
                        <MenuItem Header="Super Training" Command="{Binding OpenSuperTrainingCommand}" />
                        <MenuItem Header="Poké Puffs (XY)" Command="{Binding OpenPokepuffCommand}" />
                        <MenuItem Header="Pokéblocks (ORAS)" Command="{Binding OpenPokeBlockCommand}" />
                    </MenuItem>
                    <MenuItem Header="Gen 7">
                        <MenuItem Header="Poké Beans" Command="{Binding OpenPokebeanCommand}" />
                        <MenuItem Header="Festival Plaza" Command="{Binding OpenFestivalPlazaCommand}" />
                        <MenuItem Header="Zygarde Cells" Command="{Binding OpenZygardeCellCommand}" />
                    </MenuItem>
                    <MenuItem Header="Gen 8">
                        <MenuItem Header="Max Raids (SWSH)" Command="{Binding OpenRaidEditorCommand}" />
                    </MenuItem>
                    <MenuItem Header="Gen 9">
                        <MenuItem Header="Tera Raids (SV)" Command="{Binding OpenRaid9Command}" />
                    </MenuItem>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Options">
                <MenuItem Header="Language" ItemsSource="{Binding LanguageService.AvailableLanguages}">
                    <MenuItem.ItemTemplate>
                        <DataTemplate>
                            <MenuItem Header="{Binding Name}" Command="{Binding $parent[views:MainWindow].((vm:MainWindowViewModel)DataContext).ChangeLanguageCommand}" CommandParameter="{Binding Code}" />
                        </DataTemplate>
                    </MenuItem.ItemTemplate>
                </MenuItem>
                <MenuItem Header="Undo" Command="{Binding UndoCommand}" InputGesture="Ctrl+Z" />
                <MenuItem Header="Redo" Command="{Binding RedoCommand}" InputGesture="Ctrl+Y" />
                <Separator />
                <MenuItem Header="Settings" Command="{Binding OpenSettingsCommand}" />
                <MenuItem Header="About PKHeX" Command="{Binding OpenAboutCommand}" />
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="8,4">
            <TextBlock Text="{Binding CurrentSave.Version, StringFormat='Game: {0}', FallbackValue='No save loaded'}" />
        </Border>

        <!-- Main Content -->
        <Grid>
            <!-- No Save Loaded State -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                        IsVisible="{Binding !HasSave}">
                <TextBlock Text="Welcome to PKHeX Avalonia"
                           FontSize="24"
                           FontWeight="Light"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Open a save file to get started"
                           Opacity="0.6"
                           HorizontalAlignment="Center"
                           Margin="0,8,0,16" />
                <Button Content="Open Save File"
                        Command="{Binding OpenFileCommand}"
                        HorizontalAlignment="Center"
                        Classes="accent" />
            </StackPanel>

            <!-- Save Loaded State: WinForms-style layout -->
            <!-- Left: PKMEditor (persistent side panel) | Right: SAVEditor (tabs with Box/Party/Trainer/etc) -->
            <Grid IsVisible="{Binding HasSave}" ColumnDefinitions="700,*">
                
            <!-- Left Panel: PKM Editor (700px) -->
            <Border Grid.Column="0" 
                    BorderThickness="0,0,1,0" 
                    BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}">
                <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                    <ContentControl Content="{Binding CurrentPokemonEditor}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate DataType="vm:PokemonEditorViewModel">
                                <views:PokemonEditor />
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </ScrollViewer>
            </Border>
                
                <!-- Right Panel: SAV Editor (Box, Party, Trainer, etc.) -->
                <TabControl Grid.Column="1" Margin="0">
                    <TabItem Header="Box">
                        <views:BoxViewer DataContext="{Binding BoxViewer}" />
                    </TabItem>
                    <TabItem Header="Party">
                        <views:PartyViewer DataContext="{Binding PartyViewer}" />
                    </TabItem>
                    <TabItem Header="Trainer">
                        <ContentControl Content="{Binding TrainerEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:TrainerEditorViewModel">
                                    <views:TrainerEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Inventory">
                        <ContentControl Content="{Binding InventoryEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:InventoryEditorViewModel">
                                    <views:InventoryEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Pokédex">
                        <ContentControl Content="{Binding PokedexEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:PokedexEditorViewModel">
                                    <views:PokedexEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Events">
                        <ContentControl Content="{Binding EventFlagsEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:EventFlagsEditorViewModel">
                                    <views:EventFlagsEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Gifts">
                        <ContentControl Content="{Binding MysteryGiftEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:MysteryGiftEditorViewModel">
                                    <views:MysteryGiftEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Batch">
                        <ContentControl Content="{Binding BatchEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:BatchEditorViewModel">
                                    <views:BatchEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
