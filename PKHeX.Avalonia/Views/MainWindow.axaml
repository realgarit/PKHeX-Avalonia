<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PKHeX.Avalonia.ViewModels"
        xmlns:views="using:PKHeX.Avalonia.Views"
        x:Class="PKHeX.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="1100" Height="650"
        MinWidth="900" MinHeight="500">

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenFileCommand}" />
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveFileCommand}" />
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding SaveFileAsCommand}" />
    </Window.KeyBindings>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Open..." Command="{Binding OpenFileCommand}" InputGesture="Ctrl+O" />
                <MenuItem Header="_Save" Command="{Binding SaveFileCommand}" InputGesture="Ctrl+S" />
                <MenuItem Header="Save _As..." Command="{Binding SaveFileAsCommand}" InputGesture="Ctrl+Shift+S" />
                <Separator />
                <MenuItem Header="_Close" Command="{Binding CloseFileCommand}" />
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="Showdown">
                    <MenuItem Header="Import Set from Clipboard" Command="{Binding ImportShowdownCommand}" InputGesture="Ctrl+T" />
                    <MenuItem Header="Export Set to Clipboard" Command="{Binding ExportShowdownCommand}" InputGesture="Ctrl+Shift+T" />
                </MenuItem>
                <MenuItem Header="Data">
                    <MenuItem Header="Load Boxes" Command="{Binding LoadBoxesCommand}" />
                    <MenuItem Header="Dump Boxes" Command="{Binding DumpBoxesCommand}" />
                    <MenuItem Header="PKM Database" Command="{Binding OpenPKMDatabaseCommand}" />
                    <MenuItem Header="Mystery Gift Database" Command="{Binding OpenMysteryGiftDatabaseCommand}" />
                </MenuItem>
                <MenuItem Header="Batch Editor" Command="{Binding OpenBatchEditorCommand}" />
            </MenuItem>
            <MenuItem Header="_Options">
                <MenuItem Header="Language" IsEnabled="False" />
                <MenuItem Header="Undo" InputGesture="Ctrl+U" IsEnabled="False" />
                <MenuItem Header="Redo" InputGesture="Ctrl+Y" IsEnabled="False" />
                <Separator />
                <MenuItem Header="Settings" Command="{Binding OpenSettingsCommand}" />
                <MenuItem Header="About PKHeX" IsEnabled="False" />
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="8,4">
            <TextBlock Text="{Binding CurrentSave.Version, StringFormat='Game: {0}', FallbackValue='No save loaded'}" />
        </Border>

        <!-- Main Content -->
        <Grid>
            <!-- No Save Loaded State -->
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                        IsVisible="{Binding !HasSave}">
                <TextBlock Text="Welcome to PKHeX Avalonia"
                           FontSize="24"
                           FontWeight="Light"
                           HorizontalAlignment="Center" />
                <TextBlock Text="Open a save file to get started"
                           Opacity="0.6"
                           HorizontalAlignment="Center"
                           Margin="0,8,0,16" />
                <Button Content="Open Save File"
                        Command="{Binding OpenFileCommand}"
                        HorizontalAlignment="Center"
                        Classes="accent" />
            </StackPanel>

            <!-- Save Loaded State: WinForms-style layout -->
            <!-- Left: PKMEditor (persistent side panel) | Right: SAVEditor (tabs with Box/Party/Trainer/etc) -->
            <Grid IsVisible="{Binding HasSave}" ColumnDefinitions="700,*">
                
            <!-- Left Panel: PKM Editor (700px) -->
            <Border Grid.Column="0" 
                    BorderThickness="0,0,1,0" 
                    BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}">
                <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                    <ContentControl Content="{Binding CurrentPokemonEditor}">
                        <ContentControl.ContentTemplate>
                            <DataTemplate DataType="vm:PokemonEditorViewModel">
                                <views:PokemonEditor />
                            </DataTemplate>
                        </ContentControl.ContentTemplate>
                    </ContentControl>
                </ScrollViewer>
            </Border>
                
                <!-- Right Panel: SAV Editor (Box, Party, Trainer, etc.) -->
                <TabControl Grid.Column="1" Margin="0">
                    <TabItem Header="Box">
                        <views:BoxViewer DataContext="{Binding BoxViewer}" />
                    </TabItem>
                    <TabItem Header="Party">
                        <views:PartyViewer DataContext="{Binding PartyViewer}" />
                    </TabItem>
                    <TabItem Header="Trainer">
                        <ContentControl Content="{Binding TrainerEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:TrainerEditorViewModel">
                                    <views:TrainerEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Inventory">
                        <ContentControl Content="{Binding InventoryEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:InventoryEditorViewModel">
                                    <views:InventoryEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="PokÃ©dex">
                        <ContentControl Content="{Binding PokedexEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:PokedexEditorViewModel">
                                    <views:PokedexEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Events">
                        <ContentControl Content="{Binding EventFlagsEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:EventFlagsEditorViewModel">
                                    <views:EventFlagsEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Gifts">
                        <ContentControl Content="{Binding MysteryGiftEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:MysteryGiftEditorViewModel">
                                    <views:MysteryGiftEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                    <TabItem Header="Batch">
                        <ContentControl Content="{Binding BatchEditor}">
                            <ContentControl.ContentTemplate>
                                <DataTemplate DataType="vm:BatchEditorViewModel">
                                    <views:BatchEditor />
                                </DataTemplate>
                            </ContentControl.ContentTemplate>
                        </ContentControl>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
