<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PKHeX.Avalonia.ViewModels"
             x:Class="PKHeX.Avalonia.Views.PoketchEditorView"
             x:DataType="vm:PoketchEditorViewModel"
             Width="450" Height="500">
    <DockPanel Margin="16">
        <TextBlock DockPanel.Dock="Top" Text="Pokétch" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,8" />
        <TextBlock DockPanel.Dock="Top" Text="{Binding GameInfo}" FontSize="12" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="0,0,0,12" />

        <!-- Not Supported Message -->
        <TextBlock IsVisible="{Binding !IsSupported}" Text="This save file does not support Pokétch editing. (DPPt only)" 
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                   FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center" />

        <!-- Poketch Content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" IsVisible="{Binding IsSupported}">
            <StackPanel Spacing="12">
                <!-- Settings -->
                <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4" Padding="12">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Settings" FontWeight="SemiBold" Margin="0,0,0,4" />
                        <CheckBox Content="Pokétch Enabled" IsChecked="{Binding PoketchEnabled}" />
                        <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto">
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Color" VerticalAlignment="Center" />
                            <ComboBox Grid.Row="0" Grid.Column="1" SelectedIndex="{Binding ColorIndex}" ItemsSource="{Binding Colors}" HorizontalAlignment="Stretch" Margin="0,0,0,4" />
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Current App" VerticalAlignment="Center" />
                            <NumericUpDown Grid.Row="1" Grid.Column="1" Value="{Binding CurrentApp}" Minimum="0" Maximum="24" Margin="0,0,0,4" />
                            
                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Step Counter" VerticalAlignment="Center" />
                            <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                <NumericUpDown Value="{Binding StepCounter}" Minimum="0" Maximum="999999999" />
                                <Button Content="Reset" Command="{Binding ResetStepCounterCommand}" Padding="8,4" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Apps -->
                <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4" Padding="12">
                    <StackPanel Spacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <TextBlock Text="Unlocked Apps" FontWeight="SemiBold" VerticalAlignment="Center" />
                            <Button Content="Unlock All" Command="{Binding UnlockAllCommand}" Padding="8,4" />
                        </StackPanel>
                        <ItemsControl ItemsSource="{Binding Apps}" Margin="0,8,0,0">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="vm:PoketchAppViewModel">
                                    <CheckBox Content="{Binding Name}" IsChecked="{Binding IsUnlocked}" Width="180" Margin="0,2" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Actions -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                    <Button Content="Save Changes" Command="{Binding SaveCommand}" Padding="16,8" />
                    <Button Content="Refresh" Command="{Binding RefreshCommand}" Padding="16,8" />
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>
