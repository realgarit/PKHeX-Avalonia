<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PKHeX.Avalonia.ViewModels"
             xmlns:views="using:PKHeX.Avalonia.Views"
             x:Class="PKHeX.Avalonia.Views.Misc3Editor"
             x:DataType="vm:Misc3EditorViewModel">

    <Design.DataContext>
        <vm:Misc3EditorViewModel />
    </Design.DataContext>

    <Border Padding="16" Classes="view-container">
        <Grid RowDefinitions="*,Auto">
            <!-- Main Content with TabControl -->
            <TabControl Grid.Row="0">
                <!-- Main Tab: Records, Coins, BP -->
                <TabItem Header="Main">
                    <ScrollViewer>
                        <StackPanel Spacing="16" Margin="0,8,0,0">
                            <!-- Records Section -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Records" FontWeight="SemiBold" Opacity="0.6" />
                                    <Grid ColumnDefinitions="*,16,120">
                                        <ComboBox Grid.Column="0" 
                                                  ItemsSource="{Binding RecordList}" 
                                                  SelectedItem="{Binding SelectedRecord}"
                                                  DisplayMemberBinding="{Binding Text}"
                                                  HorizontalAlignment="Stretch" />
                                        
                                        <NumericUpDown Grid.Column="2" 
                                                       Value="{Binding RecordValue}" 
                                                       Minimum="0" Maximum="4294967295" 
                                                       ShowButtonSpinner="False" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Coins & BP Section -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Currency &amp; Misc" FontWeight="SemiBold" Opacity="0.6" />
                                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,8,Auto,8,Auto">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Coins" VerticalAlignment="Center" Width="80" />
                                        <NumericUpDown Grid.Row="0" Grid.Column="1" 
                                                       Value="{Binding Coins}" 
                                                       Minimum="0" Maximum="9999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="BP" VerticalAlignment="Center" 
                                                   IsVisible="{Binding IsBpVisible}" />
                                        <NumericUpDown Grid.Row="2" Grid.Column="1" 
                                                       Value="{Binding Bp}" 
                                                       Minimum="0" Maximum="9999" 
                                                       IsVisible="{Binding IsBpVisible}" ShowButtonSpinner="False" />

                                        <!-- FRLG Rival Name -->
                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Rival Name" VerticalAlignment="Center"
                                                   IsVisible="{Binding IsFrlg}" />
                                        <TextBox Grid.Row="4" Grid.Column="1" 
                                                 Text="{Binding RivalName}" 
                                                 MaxLength="7"
                                                 IsVisible="{Binding IsFrlg}" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Joyful Minigames Tab -->
                <TabItem Header="Joyful" IsVisible="{Binding IsJoyfulVisible}">
                    <ScrollViewer>
                        <StackPanel Spacing="16" Margin="0,8,0,0">
                            <!-- Jump Minigame -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="PokÃ©mon Jump" FontWeight="SemiBold" Opacity="0.6" />
                                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,8,Auto,8,Auto,8,Auto">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Jumps in Row" VerticalAlignment="Center" Width="100" />
                                        <NumericUpDown Grid.Row="0" Grid.Column="1" 
                                                       Value="{Binding JoyfulJumpInRow}" 
                                                       Minimum="0" Maximum="9999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="High Score" VerticalAlignment="Center" />
                                        <NumericUpDown Grid.Row="2" Grid.Column="1" 
                                                       Value="{Binding JoyfulJumpScore}" 
                                                       Minimum="0" Maximum="99999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="5-In-Row" VerticalAlignment="Center" />
                                        <NumericUpDown Grid.Row="4" Grid.Column="1" 
                                                       Value="{Binding JoyfulJump5InRow}" 
                                                       Minimum="0" Maximum="9999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Max Players" VerticalAlignment="Center" />
                                        <NumericUpDown Grid.Row="6" Grid.Column="1" 
                                                       Value="{Binding JoyfulJumpMaxPlayers}" 
                                                       Minimum="0" Maximum="9999" ShowButtonSpinner="False" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Berry Minigame -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Dodrio Berry Picking" FontWeight="SemiBold" Opacity="0.6" />
                                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,8,Auto,8,Auto,8,Auto">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Berries in Row" VerticalAlignment="Center" Width="100" />
                                        <NumericUpDown Grid.Row="0" Grid.Column="1" 
                                                       Value="{Binding JoyfulBerriesInRow}" 
                                                       Minimum="0" Maximum="9999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="High Score" VerticalAlignment="Center" />
                                        <NumericUpDown Grid.Row="2" Grid.Column="1" 
                                                       Value="{Binding JoyfulBerriesScore}" 
                                                       Minimum="0" Maximum="99999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="5-In-Row" VerticalAlignment="Center" />
                                        <NumericUpDown Grid.Row="4" Grid.Column="1" 
                                                       Value="{Binding JoyfulBerries5InRow}" 
                                                       Minimum="0" Maximum="9999" ShowButtonSpinner="False" />

                                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Berry Powder" VerticalAlignment="Center" />
                                        <NumericUpDown Grid.Row="6" Grid.Column="1" 
                                                       Value="{Binding BerryPowder}" 
                                                       Minimum="0" Maximum="99999" ShowButtonSpinner="False" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Battle Frontier Tab (Emerald only) -->
                <TabItem Header="Battle Frontier" IsVisible="{Binding IsBattleFrontierVisible}">
                    <ScrollViewer>
                        <StackPanel Spacing="16" Margin="0,8,0,0">
                            <!-- Frontier Pass -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="Frontier Pass" FontWeight="SemiBold" Opacity="0.6" />
                                    <CheckBox Content="Frontier Pass Activated" IsChecked="{Binding FrontierPassActivated}" />
                                </StackPanel>
                            </Border>

                            <!-- Symbols -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <TextBlock Text="Symbols" FontWeight="SemiBold" Opacity="0.6" VerticalAlignment="Center" />
                                        <Button Content="Give All Gold" Command="{Binding GiveAllSymbolsCommand}" FontSize="11" Padding="8,4" />
                                        <Button Content="Clear All" Command="{Binding ClearAllSymbolsCommand}" FontSize="11" Padding="8,4" />
                                    </StackPanel>
                                    
                                    <ItemsControl ItemsSource="{Binding FrontierSymbols}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="vm:FrontierSymbolViewModel">
                                                <Border Margin="0,0,8,8" Padding="8" Background="{DynamicResource ThemeBackgroundElevatedBrush}" CornerRadius="4">
                                                    <Grid ColumnDefinitions="*,Auto,Auto">
                                                        <TextBlock Grid.Column="0" Text="{Binding Name}" VerticalAlignment="Center" Width="80" />
                                                        <TextBlock Grid.Column="1" Text="{Binding StatusText}" Width="60" VerticalAlignment="Center" 
                                                                   Foreground="{Binding Status, Converter={x:Static views:Misc3EditorConverters.SymbolColorConverter}}" 
                                                                   FontWeight="Bold" TextAlignment="Center" />
                                                        <Button Grid.Column="2" Content="Cycle" Command="{Binding CycleStatusCommand}" 
                                                                FontSize="11" Padding="6,2" Margin="8,0,0,0" />
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Ferry Tab (Emerald only) -->
                <TabItem Header="Ferry" IsVisible="{Binding IsFerryVisible}">
                    <ScrollViewer>
                        <StackPanel Spacing="16" Margin="0,8,0,0">
                            <!-- Reach Destinations -->
                            <Border Classes="section-card" Padding="12">
                                <StackPanel Spacing="12">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <TextBlock Text="Ferry Destinations" FontWeight="SemiBold" Opacity="0.6" VerticalAlignment="Center" />
                                        <Button Content="Unlock All" Command="{Binding UnlockAllFerryDestinationsCommand}" FontSize="11" Padding="8,4" />
                                    </StackPanel>
                                    
                                    <CheckBox Content="Mew Catchable (Faraway Island)" IsChecked="{Binding MewCatchable}" FontWeight="SemiBold" />
                                    
                                    <TextBlock Text="Can Reach:" FontWeight="SemiBold" Opacity="0.6" Margin="0,8,0,4" />
                                    <WrapPanel>
                                        <CheckBox Content="Southern Island" IsChecked="{Binding ReachSouthernIsland}" Margin="0,0,16,4" />
                                        <CheckBox Content="Birth Island" IsChecked="{Binding ReachBirthIsland}" Margin="0,0,16,4" />
                                        <CheckBox Content="Faraway Island" IsChecked="{Binding ReachFarawayIsland}" Margin="0,0,16,4" />
                                        <CheckBox Content="Navel Rock" IsChecked="{Binding ReachNavelRock}" Margin="0,0,16,4" />
                                        <CheckBox Content="Battle Frontier" IsChecked="{Binding ReachBattleFrontier}" Margin="0,0,16,4" />
                                    </WrapPanel>

                                    <TextBlock Text="Initial Visit Complete:" FontWeight="SemiBold" Opacity="0.6" Margin="0,8,0,4" />
                                    <WrapPanel>
                                        <CheckBox Content="Southern Island" IsChecked="{Binding InitialSouthernIsland}" Margin="0,0,16,4" />
                                        <CheckBox Content="Birth Island" IsChecked="{Binding InitialBirthIsland}" Margin="0,0,16,4" />
                                        <CheckBox Content="Faraway Island" IsChecked="{Binding InitialFarawayIsland}" Margin="0,0,16,4" />
                                        <CheckBox Content="Navel Rock" IsChecked="{Binding InitialNavelRock}" Margin="0,0,16,4" />
                                    </WrapPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>

            <!-- Bottom Buttons -->
            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0" Spacing="12">
                <Button Content="Save" Command="{Binding SaveCommand}" Classes="accent" MinWidth="100" HorizontalContentAlignment="Center" />
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
